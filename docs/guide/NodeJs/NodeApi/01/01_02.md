# 包管理工具

## npm 概述

1. `Node Package Manager`，也就是 `Node` 包管理器，是目前已经不仅仅是 `Node` 包管理器了，在前端项目中也在使用它来管理依赖的包。
2. [npm 包官网](https://www.npmjs.com/)，发布自己的包其实是发布到 `registry` 上面的，安装一个包时其实是从 `registry` 上面下载的包。
3. 每一个项目都会有一个对应的配置文件配置文件在 `Node` 环境下面（无论是前端还是后端）就是 `package.json`。

## 配置文件

1. 创建配置文件

```js
npm init // 创建时需要填写信息
npm init -y // 创建时使用默认信息
```

2. 常见的属性

- `name`: 项目名称
- `version`: 当前项目版本号
- `description`: 描述信息，作为项目的基本描述
- `author`: 作者相关信息，发布时用到
- `license`: 使用的开源协议，发布时使用到
- `private`: 表示项目是否为私有，当值为 `true` 时，`npm` 是不能发布项目
- `main`: 设置程序的入口文件
- `scripts`: 设置脚本命令，可以通过 `npm run xxx` 运行。对于常用的 `start`、 `test`、`stop`、`restart` 可以省略掉 `run` 直接通过 `npm start` 等方式运行。
- `dependencies`: 无论开发环境还是生产环境都需要依赖的包，可以用`npm install --production` 来只安装生产时的依赖，不安装开发时依赖包。
- `devDependencies`: 开发时的依赖包，可以通过 `npm install 'package' --save-dev`，将它安装到 `devDependencies` 属性中。
- `engines`: 用于指定 `Node` 和 `NPM` 的版本号。事实上也可以指定所在的操作系统，只是很少用到。
- `browserslist`: 用于配置打包后的 `JavaScript` 浏览器的兼容情况。

```js
{
  "name": "project",
  "version": "1.0.0",
  "description": "A note project",
  "author": "yang zebo",
  "license": "ISC",
  "private": true,
  "main": "main.js",
  "scripts": {
    "dev": "cross-env ENV_STAGE=dev vue-cli-service serve"
  },
  "dependencies": {
    "vue": "^2.5.2"
  },
  "engines": {
    "node": ">= 6.0.0",
    "npm": ">= 3.0.0",
    "os": [ "darwin", "linux" ]
  },
  "browserslist": {
    "> 1%",
    "last 2 versions",
    "not ie <= 8"
  }
}
```

## 版本管理

1. `npm` 的包通常遵从 `semver` 版本规范。[semver](https://semver.org/lang/zh-CN/)。
2. `semver` 版本规范是 `X.Y.Z`。

- `X` 主版本号：当你做了不兼容的 `API` 修改，可能不兼容之前的版本。
- `Y` 次版本号：当你做了向下兼容的功能性新增，新功能增加，但是兼容之前的版本。
- `Z` 修订号：当你做了向下兼容的问题修正没有新功能，修复了之前版本的 `bug`。

3. `^`和`~`的区别:

- `^x.y.z`: 表示`x`是保持不变的，`y`和`z`永远安装最新的版本。
- `~x.y.z`: 表示`x`和`y`保持不变的，`z`永远安装最新的版本。

## npm 常用命令

1. 全局安装通常安装的包都是一些工具包：`yarn`、`webpack` 等。`axios`、`express`、`koa` 等库文件，全局安装了之后并不能让我们在所有的项目中使用 `axios` 等库。项目安装会在当前目录下生产一个 `node_modules` 文件夹。

- `npm install 'package' -g`: 全局安装。
- `npm install 'package'`: 项目（局部）安装。

2. 局部安装分为开发时依赖和生产时依赖。

- 安装开发和生产依赖`npm install axios`，`npm i axios`。
- 开发依赖`npm install 'package' --save-dev`，`npm install 'package' -D`，`npm i 'package' –D`。
- `npm install`: 根据 `package.json` 中的依赖包安装。

3. 卸载某个依赖包

- `npm uninstall package`
- `npm uninstall package --save-dev`
- `npm uninstall package -D`

4. 强制重新安装与清除缓存

- 强制重新`build`: `npm rebuild`
- 清除缓存: `npm cache clean`

## 安装过程

## package-lock.json

## 其他工具

### yarn 工作

```js
yarn install
yarn add [package]
yarn add [package] --dev, yarn add [package] -D
```

### cnpm 工作

1. 查看 `npm` 镜像与设置 `npm` 的镜像。

```js
npm config get registry // https://registry.npmjs.org
`npm config set registry https://registry.npm.taobao.org`
```

2. 对于大多数人来说，并不希望将`npm`镜像修改了，这个时候，全局安装 `cnpm` 工具，并且将 `cnpm` 镜像设置为淘宝的镜像。

```js
;`npm install -g cnpm --registry=https://registry.npm.taobao.org`
;`cnpm config get registry # https://r.npm.taobao.org/`
```

### npx 工具

1. `npx` 是 `npm5.2` 之后自带的一个命令。

- 假如在全局和项目都安装`webpack`，全局安装的是 `webpack5.1.3`，项目安装的是 `webpack3.6.0`。
- 假如在终端 `webpack --version`，得到的是`webpack5.1.3`
- 明确查找到 `node_module` 下面的 `webpack` 可以使用 `npx` 命令 `npx webpack --version`。
